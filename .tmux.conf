unbind C-b
set -g prefix C-a

# Keys
unbind %
bind | split-window -h
bind - split-window -v
unbind ^D
bind ^D detach
unbind A
bind A command-prompt "rename-window %%"
unbind ^L
bind ^L refresh-client

bind-key C-a last-window
bind-key a send-prefix
bind-key k confirm kill-window
bind-key K confirm kill-server

# Set status bar
set-option -g status-utf8 on
set -g status-bg black
set -g status-fg white
set -g status-left '#[fg=green]#H'
set -g status-right '#[fg=yellow]#(uptime | cut -d "," -f 2-)'
set-window-option -g window-status-current-bg red

set -g set-titles on
set -g set-titles-string '#H:#S.#I.#P #W #T'

set -g default-terminal "xterm"

setw -g monitor-activity on
set -g visual-activity on

setw -g automatic-rename on

set-option -g pane-active-border-fg green
set-option -g pane-active-border-bg black
set-option -g pane-border-fg white
set-option -g pane-border-bg black

# Make mouse useful in copy mode
setw -g mode-mouse on

# Allow mouse to select which pane to use
set -g mouse-select-pane on

# Lower escape timing from 500ms to 50ms for quicker response to scroll-buffer access.
set -s escape-time 50

#-----------------------------------------------------------------------------
# windows
#-----------------------------------------------------------------------------

# create window
bind-key -n M-e command-prompt "new-window -n '%%'"
bind-key -n M-E command-prompt -I '#W' "rename-window '%%'"

# focus window
bind-key -n M-Left previous-window
bind-key -n M-Right next-window

# focus by number
set-option -g base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on
bind-key -n M-0 choose-window
bind-key -n M-1 select-window -t :1
bind-key -n M-2 select-window -t :2
bind-key -n M-3 select-window -t :3
bind-key -n M-4 select-window -t :4
bind-key -n M-5 select-window -t :5
bind-key -n M-6 select-window -t :6
bind-key -n M-7 select-window -t :7
bind-key -n M-8 select-window -t :8
bind-key -n M-9 select-window -t :9

#-----------------------------------------------------------------------------
# panes
#-----------------------------------------------------------------------------

# Split panes
bind-key -n 'M-_' split-window -v
bind-key -n 'M-|' split-window -h

# zoom pane
bind-key -n M-m resize-pane -Z

# attach by number
bind-key -n 'M-!' join-pane -t :1
bind-key -n 'M-@' join-pane -t :2
bind-key -n 'M-#' join-pane -t :3
bind-key -n 'M-$' join-pane -t :4
bind-key -n 'M-%' join-pane -t :5
bind-key -n 'M-^' join-pane -t :6
bind-key -n 'M-&' join-pane -t :7
bind-key -n 'M-*' join-pane -t :8
bind-key -n 'M-(' join-pane -t :9
bind-key -n 'M-)' choose-window 'join-pane -t "%%"'

# promote pane (toggle)
bind-key -n M-Enter if-shell 'test #P -ne 1' 'select-pane -t 1' 'last-pane; swap-pane -s 1'

# rotate panes
bind-key -n M-a rotate-window -D
bind-key -n M-A rotate-window -U

#-----------------------------------------------------------------------------
# scrollback buffer
#-----------------------------------------------------------------------------

# buffer length
set-option -g history-limit 32767

# search buffer (using less if Vim is not available)
bind-key -n M-/ capture-pane -S -32767 -J \; new-window ' \
  tmux save-buffer - \; delete-buffer | { \
    vim -R -c "set nofen is hls ic" -; \
    test $? -eq 127 && less; \
  }; \
' \; send-keys G ? # go to bottom and search upward

#-----------------------------------------------------------------------------
# colors (solarized)
#-----------------------------------------------------------------------------

# default statusbar colors
set-option -g status-bg colour235 #base02
set-option -g status-fg colour136 #yellow
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg colour244 #base0
set-window-option -g window-status-bg default
#set-window-option -g window-status-attr dim

# active window title colors
set-window-option -g window-status-current-fg colour166 #orange
set-window-option -g window-status-current-bg default
#set-window-option -g window-status-current-attr bright

# pane border
set-option -g pane-border-fg colour235 #base02
set-option -g pane-active-border-fg colour240 #base01

# message text
set-option -g message-bg colour235 #base02
set-option -g message-fg colour166 #orange

# pane number display
set-option -g display-panes-active-colour colour33 #blue
set-option -g display-panes-colour colour166 #orange

# clock
set-window-option -g clock-mode-colour colour64 #green

# update environment
set -g update-environment -r
