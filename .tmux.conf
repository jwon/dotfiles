unbind C-b
set -g prefix C-a

# Keys
unbind %
bind | split-window -h
bind - split-window -v
unbind ^D
bind ^D detach
unbind A
bind A command-prompt "rename-window %%"
unbind ^L
bind ^L refresh-client

bind-key C-a last-window
bind-key a send-prefix
bind-key k confirm kill-window
bind-key K confirm kill-server

set -g set-titles on
set -g set-titles-string '#H:#S.#I.#P #W #T'

set-option -g default-terminal screen-256color

setw -g monitor-activity on
set -g visual-activity on

setw -g automatic-rename on

set-option -g pane-active-border-fg green
set-option -g pane-active-border-bg black
set-option -g pane-border-fg white
set-option -g pane-border-bg black

# Enable Mouse support
set -g mouse on

# make scrolling with wheels work
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# Lower escape timing from 500ms to 50ms for quicker response to scroll-buffer access.
set -s escape-time 50

#-----------------------------------------------------------------------------
# windows
#-----------------------------------------------------------------------------

# create window
bind-key -n M-e command-prompt "new-window -n '%%'"
bind-key -n M-E command-prompt -I '#W' "rename-window '%%'"

# focus window
bind-key -n M-Left previous-window
bind-key -n M-Right next-window

# focus by number
set-option -g base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on
bind-key -n M-0 choose-window
bind-key -n M-1 select-window -t :1
bind-key -n M-2 select-window -t :2
bind-key -n M-3 select-window -t :3
bind-key -n M-4 select-window -t :4
bind-key -n M-5 select-window -t :5
bind-key -n M-6 select-window -t :6
bind-key -n M-7 select-window -t :7
bind-key -n M-8 select-window -t :8
bind-key -n M-9 select-window -t :9

#-----------------------------------------------------------------------------
# panes
#-----------------------------------------------------------------------------

# Split panes
bind-key -n 'M-_' split-window -v
bind-key -n 'M-|' split-window -h

# zoom pane
bind-key -n M-m resize-pane -Z

# attach by number
bind-key -n 'M-!' join-pane -t :1
bind-key -n 'M-@' join-pane -t :2
bind-key -n 'M-#' join-pane -t :3
bind-key -n 'M-$' join-pane -t :4
bind-key -n 'M-%' join-pane -t :5
bind-key -n 'M-^' join-pane -t :6
bind-key -n 'M-&' join-pane -t :7
bind-key -n 'M-*' join-pane -t :8
bind-key -n 'M-(' join-pane -t :9
bind-key -n 'M-)' choose-window 'join-pane -t "%%"'

# promote pane (toggle)
bind-key -n M-Enter if-shell 'test #P -ne 1' 'select-pane -t 1' 'last-pane; swap-pane -s 1'

# rotate panes
bind-key -n M-a rotate-window -D
bind-key -n M-A rotate-window -U

# synchronize all panes in a window
bind y setw synchronize-panes

#-----------------------------------------------------------------------------
# scrollback buffer
#-----------------------------------------------------------------------------

# buffer length
set-option -g history-limit 32767

# search buffer (using less if Vim is not available)
bind-key -n M-/ capture-pane -S -32767 -J \; new-window ' \
  tmux save-buffer - \; delete-buffer | { \
    vim -R -c "set nofen is hls ic" -; \
    test $? -eq 127 && less; \
  }; \
' \; send-keys G ? # go to bottom and search upward

#-----------------------------------------------------------------------------
# colors (solarized)
#-----------------------------------------------------------------------------

# pane border
set-option -g pane-border-fg colour235 #base02
set-option -g pane-active-border-fg colour240 #base01

# message text
set-option -g message-bg colour235 #base02
set-option -g message-fg colour166 #orange

# pane number display
set-option -g display-panes-active-colour colour33 #blue
set-option -g display-panes-colour colour166 #orange

# clock
set-window-option -g clock-mode-colour colour64 #green

run-shell "powerline-daemon -q"
source "/home/jwon/src/powerline-status/env/lib/python2.6/site-packages/powerline/bindings/tmux/powerline.conf"

#bind C-c run "tmux save-buffer - | pbcopy-remote"
#bind C-v run "tmux set-buffer $(pbpaste-remote); tmux paste-buffer"

# update environment
set -g update-environment -r
# fix ssh agent when tmux is detached
setenv -g SSH_AUTH_SOCK $HOME/.ssh/ssh_auth_sock
